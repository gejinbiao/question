# Redis常见面试题
0. Redis为什么是key，value的，为什么不是支持SQL的

		选择key-value的原因：key-value简单粗暴，使用方便？效率更佳？
		为什么不支持sql：
		因为redis的内存模型是一个hashtable，不使用表来存储数据，也不会预定义或强制要求用户对redis储存的不同数据进行关联。

1. redis是多线程还是单线程

		redis中io多路复用器模块是单线程执行，事件处理器也是单线程执行，两个线程不一样。所以实际redis应该是单进程多线程，只是不同的模块都用的单线程实现。
		两个维度来举例：
		（1）若是client发送命令到server的话，server处理命令是单线程逐条进行的。
		（2）server内部可以是多线程的，比如aof持久化，假设策略每秒，那就是再单独开启一个线程去执行aof文件持久化操作，这就是多线程了。

2. 为什么说redis能够快速执行

	    1. 绝大部分请求是纯粹的内存操作（非常快速）
    	2.  采用单线程,避免了不必要的上下文切换和竞争条件
    	3.  非阻塞IO - IO多路复用
3. redis的内部实现

		内部实现采用epoll，采用了epoll+自己实现的简单的事件框架。epoll中的读、写、关闭、连接都转化成了事件，然后利用epoll的多路复用特性，绝不在io上浪费一点时间 这3个条件不是相互独立的，特别是第一条，如果请求都是耗时的，采用单线程吞吐量及性能可想而知了。应该说redis为特殊的场景选择了合适的技术方案。

4. Redis关于线程安全问题

   	`redis实际上是采用了线程封闭的观念，把任务封闭在一个线程，自然避免了线程安全问题，不过对于需要依赖多个redis操作的复合操作来说，依然需要锁，而且有可能是分布式锁。`

5. 使用Redis有哪些好处？

		(1) 速度快，因为数据存在内存中，类似于HashMap，HashMap的优势就是查找和操作的时间复杂度都是O(1)

		(2) 支持丰富数据类型，支持string，list，set，sorted set，hash

		(3) 支持事务，操作都是原子性，所谓的原子性就是对数据的更改要么全部执行，要么全部不执行

		(4) 丰富的特性：可用于缓存，消息，按key设置过期时间，过期后将会自动删除

6. Redis常见性能问题和解决方案：

		(1) Master最好不要做任何持久化工作，如RDB内存快照和AOF日志文件；(Master写内存快照，save命令调度rdbSave函数，会阻塞主线程的工作，当快照比较大时对性能影响是非常大的，会间断性暂停服务，所以Master最好不要写内存快照;AOF文件过大会影响Master重启的恢复速度)

		(2) 如果数据比较重要，某个Slave开启AOF备份数据，策略设置为每秒同步一次

		(3) 为了主从复制的速度和连接的稳定性，Master和Slave最好在同一个局域网内

		(4) 尽量避免在压力很大的主库上增加从库

		(5) 主从复制不要用图状结构，用单向链表结构更为稳定，即：Master <- Slave1 <- Slave2 <- Slave3...；这样的结构方便解决单点故障问题，实现Slave对Master的替换。如果Master挂了，可以立刻启用Slave1做Master，其他不变。

7. Redis的回收策略

		volatile-lru：从已设置过期时间的数据集（server.db[i].expires）中挑选最近最少使用的数据淘汰

		volatile-ttl：从已设置过期时间的数据集（server.db[i].expires）中挑选将要过期的数据淘汰
		
		volatile-random：从已设置过期时间的数据集（server.db[i].expires）中任意选择数据淘汰
		
		allkeys-lru：从数据集（server.db[i].dict）中挑选最近最少使用的数据淘汰
		
		allkeys-random：从数据集（server.db[i].dict）中任意选择数据淘汰
		
		no-enviction（驱逐）：禁止驱逐数据
		
		注意这里的6种机制，volatile和allkeys规定了是对已设置过期时间的数据集淘汰数据还是从全部数据集淘汰数据，后面的lru、ttl以及random是三种不同的淘汰策略，再加上一种no-enviction永不回收的策略。
		
		　　使用策略规则：
		
		　　1、如果数据呈现幂律分布，也就是一部分数据访问频率高，一部分数据访问频率低，则使用allkeys-lru
		
		　　2、如果数据呈现平等分布，也就是所有的数据访问频率都相同，则使用allkeys-random

8. Redis的持久化开启了RDB和AOF下重启服务是如何加载的？

		优先AOF，AOF没找到的话再找RDB，因为AOF文件的数据要全于RDB。

9. Redis如果做集群该如何规划？AKF/CAP如何实现和设计？

		参考redis各种部署方式的优缺点来决定。
		如果希望快速部署，那么可以考虑单节点部署方式。
		如果只需要考虑可靠性，那么可以考虑主从复制模式。
		如果想要保证高可用，不需要考虑储存成本可以考虑哨兵模式。
		如果想提高集群的扩展性和可用性，不要求保证数据的强一致性，且没有批量操作，那么可以考虑集群模式。
		大白话图文结合的方式讲解什么是CAP
		AKF分为三个维度：XYZ轴，具体Google…

10. 10万用户一年365天的登录情况如何用redis存储，并快速检索任意时间窗内的活跃用户？

		bitmap，直接看下文会大彻大悟。
	[Redis的bitmap从基础到业务](https://blog.csdn.net/ctwctw/article/details/105013817)

11. 100万并发4G数据，10万并发400G数据，如何设计Redis存储方式？

		我肤浅的理解为：
		前者用主从+哨兵进行高可用，加快读请求的速度，减轻单节点的压力。
		一文掌握Redis的主从复制原理到实战
		一文掌握Redis的哨兵Sentinel原理到实战
		后者用集群来均分这400G数据。 但是感觉不是面试官想要的答案。